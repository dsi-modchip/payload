
srcdir = ''

sources = []
sources_7 = [
  'src7/fakestack.S',
  'src7/start.S',
  'src7/main.c'
]
sources_9 = [
  'src9/ropchain.S',
  'src9/start.S',
  'src9/main.c'
]

link_args = [
  #'-specs=' + lib / 'nocrt0.specs',
  '-nostartfiles', '-nostdlib'
]

if arm7_build
  srcdir = 'src7/'
  sources += sources_7
  link_args += [ '-Tlink7.ld' ]
elif arm9_build
  srcdir = 'src9/'
  sources += sources_9
  link_args += [ '-Tlink9.ld' ]
endif

link_args += [ '-L' + meson.current_source_dir() ]
ld_h = run_command(cc, '-Wl,--help', capture: true, check: false)
if ld_h.stdout().contains('--no-warn-rwx-segments')
  link_args += '-Wl,--no-warn-rwx-segments'
endif

exploit = executable('exploit',
  sources,
  dependencies: [libdawn_hw, libdawn_baremetalrt],
  link_args: link_args,
  name_suffix: 'elf')

